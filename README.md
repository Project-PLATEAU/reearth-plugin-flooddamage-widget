# SAR衛星解析による洪水被害の推定結果の可視化を行うRe:Earthプラグイン

## 1. 概要 <!-- 本リポジトリでOSS化しているソフトウェア・ライブラリについて1文で説明を記載ください -->
本リポジトリでは、Project PLATEAUの令和4年度のユースケース開発業務の一部であるUC23-01「人工衛星観測データを用いた浸水被害把握等」について、その成果物である「SAR衛星解析結果の可視化を行うRe:Earthプラグイン」のソースコードを公開しています。

「SAR衛星解析結果の可視化を行うRe:Earthプラグイン」は、「[SAR衛星解析による洪水被害の推定システム](https://github.com/Project-PLATEAU/SAR-image-based-flood-damage-detector/)」による解析結果をRe:Earth Viewerにて可視化するためのRe:Earthプラグインです。

## 2. 「人工衛星観測データを用いた浸水被害把握等」について <!-- 「」内にユースケース名称を記載ください。本文は以下のサンプルを参考に記載ください。URLはアクセンチュアにて設定しますので、サンプルそのままでOKです。 -->
「人工衛星観測データを用いた浸水被害把握等」では、洪水等の浸水被害発生直後の人工衛星観測データ（SARデータ）から分析した浸水範囲と3D都市モデルの地形モデル及び建築物モデルをマッチングさせることで、家屋単位での浸水深の算出および被災判定を行うシステムを開発する。さらに、導出された被災家屋リストをデータベース化し、WebGISエンジン「Re:Earth」上で可視化するシステムを構築することで、行政における罹災証明書発行業務の効率化を目指す。
本システムは、人工衛星観測データ（SARデータ）と3D都市モデルによって取得された浸水範囲と家屋単位の被災判定結果を、Re:Earth上で可視化するシステムを開発した。
本システムは、行政職員向けのGUIを備えたオープンソースソフトウェアとしてフルスクラッチで開発されています。
本システムの詳細については[技術検証レポート](https:XXX)を参照してください。

## 3. 利用手順 <!-- 下記の通り、GitHub Pagesへリンクを記載ください。URLはアクセンチュアにて設定しますので、サンプルそのままでOKです。 -->
本システムの構築手順及び利用手順については[利用チュートリアル](https:XXX)を参照してください。

## 4. システム概要 <!-- OSS化対象のシステムが有する機能を記載ください。 -->
### 【罹災証明書発行プラグインウィジェットの設定】
#### ①被災建物リスト（CSV形式）と3D都市モデルの連動
- 罹災証明書発行プラグインのResourceに行政区分図と被災カテゴリごとの色分けと連動させる3D都市モデルの3DTilesのタイトルを入力する。
- 罹災証明書発行プラグインのデータリストに追加したい衛星画像の解析結果のタイトルと建物被災データの入力を行う。
- データリストを追加することで、衛星画像の取得日時を選択できるようになり、建物被災データが入力されることで、3D都市モデルの属性データと連動する。

### 【レイヤー管理ウィジェットの設定】
#### ②ベースマップの編集
- ベースマップの選択を行えるように、タイルリストを追加し、ベースマップとサムネイル画像とタイトルを設定することで、プラグイン上でベースマップの切り替えが行えるようになる。

#### ③Resourceタブ
- 3D都市モデルの3DTilesのタイトルを入力することで3D都市モデルの表示／非表示の切り替えを行えるようになる。3Dビュー上の3D都市モデルをクリックすることで、被災建物情報と3D都市モデルに格納されている属性情報を確認できる。
- 行政区分図タイトルを設定することで町丁目データが可視化され表示／非表示の切り替えを行えるようになる。
- e-Stat非就業者世帯数のデータを設定することで、e-Stat非就業者世帯数が可視化され表示／非表示の切り替えを行えるようになる。

#### ④衛星画像の取得日時の選択と連動したデータの表示／非表示
- 以下のデータ項目について、リストを追加して、該当データの設定を行うことで可視化され表示／非表示の切り替えを行えるようになる。
- リストは衛星画像の取得日時の選択と連動して、データの切り替えが行われるようになる。

| 名称 | 内容 |
| --- | --- |
| 浸水域2D表現 | 衛星解析によって得られる浸水域のXYZタイルデータ |
| 浸水域3D表現（点群） | 衛星解析によって得られる浸水域の点群の3Dタイルデータ |
| 浸水域3D表現（ポリゴン） | 衛星解析によって得られる浸水域を3Dのポリゴンデータ化したもの |
| 床上(木造)データ | 衛星解析によって得られる床上浸水（木造）のヒートマップ |
| 床下(木造)データ | 衛星解析によって得られる床下浸水（木造）のヒートマップ |
| 木造家屋総数データ | 衛星解析によって得られる木造家屋総数のヒートマップ |

### 【罹災証明書発行プラグインウィジェットの操作】
#### ⑤衛星画像の取得日時の選択
- 表示する衛星画像の取得日時を選択することができる。
- 建物被災データや、浸水域2D表現をはじめとしたデータの切り替えが行える。

#### ⑥被災建物件数の表示
- 被災建物件数と被災カテゴリ別の被災建物件数を表示する。
- 町丁目を選択することで町丁目単位の被災建物件数と被災カテゴリ別の被災建物件数を表示する。

#### ⑦建物のスタイリング
- 3Dビュー上の3D都市モデルの被災カテゴリ別の色分けの設定を行うことができる。

#### ⑧データのダウンロード
- 選択した町丁目単位のデータのダウンロードができる。

### 【レイヤー管理ウィジェットの操作】
#### ⑨データの表示／非表示
- データの表示／非表示が選択できる。

## 5. 利用技術

| 種別              | 名称   | バージョン | 内容 |
| ----------------- | --------|-------------|-----------------------------|
| ライブラリ      | [D3](https://d3js.org/) | 7.8.5 | JavaScriptベースのデータ可視化ライブラリ  |
|       | [shapefile-js](https://github.com/calvinmetcalf/shapefile-js) | 4.0.2 | JavaScriptでShapefile形式の地理データを扱うライブラリ |
|       | [Moment.js](https://momentjs.com/) | 2.29.4 | JavaScriptの日時操作を簡素化し、使いやすくするライブラリ |

## 6. 動作環境 <!-- 動作環境についての仕様を記載ください。 -->
| 項目               | 最小動作環境                                                                                                                                                                                                                                                                                                                                    | 推奨動作環境                   | 
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ | 
| OS                 | Webブラウザが動作する全てのデスクトップOS（Windows, macOS, Linux, Chrome OS）やモバイルOS（iOS、Andorid）に対応                                                                                                                                                                                                                                                                                                                |  同左 | 
| 対応ブラウザ                | Chrome 58_ <br> Firefox 57+ <br> Safari 11+（macOSのみ） <br> Microsoft Edge XX 以降 <br> iOS(11+) Safari <br> Android(10+) Chrome                                                                                                                                                                                                                                                                                                                               |  同左  | 
| ディスプレイ解像度 | 1000×700以上                                                                                                                                                                                                                                                                                                                                    |  同左                   | 
| ネットワーク       | 必要 |  同左                            | 

## 7. 本リポジトリのフォルダ構成 <!-- 本GitHub上のソースファイルの構成を記載ください。 -->
| フォルダ名 |　詳細 |
|-|-|
| building-style | 罹災証明書発行支援プラグイン（ダッシュボード部） |
| layer-management | レイヤー管理プラグイン |
| 3d-tiles-inspector | Infoboxプラグイン |


## 8. ライセンス <!-- 変更せず、そのまま使うこと。 -->

- ソースコード及び関連ドキュメントの著作権は国土交通省に帰属します。
- 本ドキュメントは[Project PLATEAUのサイトポリシー](https://www.mlit.go.jp/plateau/site-policy/)（CCBY4.0及び政府標準利用規約2.0）に従い提供されています。

## 9. 注意事項 <!-- 変更せず、そのまま使うこと。 -->

- 本リポジトリは参考資料として提供しているものです。動作保証は行っていません。
- 本リポジトリについては予告なく変更又は削除をする可能性があります。
- 本リポジトリの利用により生じた損失及び損害等について、国土交通省はいかなる責任も負わないものとします。

## 10. 参考資料 <!-- 技術検証レポートのURLはアクセンチュアにて記載します。 -->
- 技術検証レポート: https:XXX
- PLATEAU WebサイトのUse caseページ「人工衛星観測データを用いた浸水被害把握」: https://www.mlit.go.jp/plateau/use-case/uc23-01/
